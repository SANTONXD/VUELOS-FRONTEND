<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Login - Vuelos</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>

<header>
  <h1>Iniciar sesión</h1>
</header>

<nav>
  <a href="index.html">Inicio</a>
  <a href="register.html">Registrarse</a>
</nav>

<main>

<form id="loginForm">
  <label>Email
    <input type="email" name="email" required>
  </label>

  <label>Contraseña
    <input type="password" name="password" required>
  </label>

  <button type="submit">Entrar</button>
</form>

<p>¿No tienes cuenta? <a href="register.html">Crear cuenta</a></p>

<section id="msg"></section>

</main>

<footer>
  <a href="https://github.com/SANTONXD/VUELOS-FRONTEND/tree/main" target="_blank">
    <svg height="24" width="24" viewBox="0 0 16 16" fill="#b44a55">
      <path d="M8 0C3.58 0 0 3.58 0 8a8 ..."></path>
    </svg>
  </a>
</footer>

<script>
  const API_BASE = 'https://proyecto-sis.onrender.com';
  const form = document.getElementById('loginForm');
  const msg = document.getElementById('msg');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    msg.textContent = 'Enviando...';
    const fd = new FormData(form);
    const body = {
      email: fd.get('email'),
      password: fd.get('password')
    };

    try {
      const res = await fetch(API_BASE + '/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });

      const data = await res.json();
      if (!res.ok) return msg.textContent = data.error;

      localStorage.setItem('token', data.token);
      msg.textContent = 'Login correcto...';
      setTimeout(() => location.href = 'flights.html', 600);

    } catch (err) {
      msg.textContent = 'Error: ' + err.message;
    }
  });
</script>

</body>
</html>
