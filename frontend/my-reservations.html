<!doctype html>
<html lang="es">
<head><meta charset="utf-8"><title>Mis Reservas</title></head>
<body>
  <h1>Mis Reservas</h1>
  <button id="backBtn">Volver</button>
  <ul id="reservationsList"></ul>
  <p id="msg"></p>

  <script>
    const API_BASE = 'http://localhost:4000';
    const token = localStorage.getItem('token');
    if (!token) location.href = 'login.html';

    const msg = document.getElementById('msg');
    const list = document.getElementById('reservationsList');
    const backBtn = document.getElementById('backBtn');
    backBtn.onclick = () => location.href = 'flights.html';

    async function loadReservations() {
      msg.textContent = 'Cargando...';
      try {
        const res = await fetch(API_BASE + '/reservations/my-reservations', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        const data = await res.json();
        list.innerHTML = '';
        if (!Array.isArray(data) || data.length === 0) {
          list.innerHTML = '<li>No tienes reservas aún.</li>';
          msg.textContent = '';
          return;
        }
        data.forEach(r => {
          const li = document.createElement('li');
          li.textContent = `${r.origin} → ${r.destination} | ${r.seat_number} | ${new Date(r.departure).toLocaleString()} | Código: ${r.code}`;
          list.appendChild(li);
        });
        msg.textContent = '';
      } catch (err) {
        msg.textContent = 'Error: ' + err.message;
      }
    }

    loadReservations();
  </script>
</body>
</html>
